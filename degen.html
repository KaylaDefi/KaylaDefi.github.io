<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Degen Tracker</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <header id="main-header">
    <h1 class="centered-text">Degen Wallet Transfer Tracker</h1>
  </header>

  <main id="main">
    <button id="refresh-button">üîÅ Refresh Data</button>
    <table id="tx-table" border="1" style="width:100%; margin-top:20px; border-collapse: collapse;">
      <thead>
        <tr>
          <th>From</th>
          <th>To</th>
          <th>Value (ETH)</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody>
        <!-- Filled dynamically -->
      </tbody>
    </table>
  </main>

  <footer id="main-footer">
    <p>&copy; 2025 Kayla's Degen Tracker</p>
  </footer>

  <script>
    const supabaseUrl = 'https://onhgxdrgynmoufponeuy.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9uaGd4ZHJneW5tb3VmcG9uZXV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODQ5NjQsImV4cCI6MjA2NjQ2MDk2NH0.OB64qtsRqFuGQubUxbQYABuRcqv0-wZ6f-wUdmI5AIs'; 
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function fetchTransactions() {
      const table = document.querySelector('#tx-table tbody');
      table.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';

      const { data, error } = await supabase
        .from('degen_transfers')
        .select('from_addr, to_addr, value, timestamp')
        .order('timestamp', { ascending: false })
        .limit(77);

        console.log("üì¶ Supabase Data:", data);
        console.log("‚ö†Ô∏è Supabase Error:", error);

        if (error) {
          table.innerHTML = `<tr><td colspan="4">Error loading data</td></tr>`;
          return;
        }

  if (!data || data.length === 0) {
    table.innerHTML = `<tr><td colspan="4">No data found</td></tr>`;
    return;
  }

      table.innerHTML = '';
      data.forEach(tx => {
        const row = document.createElement('tr');

        const fromCell = `<td>${tx.from_addr || '‚Äî'}</td>`;
        const toCell = `<td>${tx.to_addr || '‚Äî'}</td>`;
        const valueEth = parseFloat(tx.value || 0) / 1e18;
        const valueCell = `<td>${valueEth.toFixed(4)} ETH</td>`;
        const time = new Date(tx.timestamp).toLocaleString();
        const timeCell = `<td>${time}</td>`;

        row.innerHTML = fromCell + toCell + valueCell + timeCell;
        table.appendChild(row);
      });
    }

    document.querySelector('#refresh-button').addEventListener('click', fetchTransactions);

    // Fetch on load
    fetchTransactions();
  </script>
</body>
</html>
